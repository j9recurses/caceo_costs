require 'csv'
source = 'http://www.devinbunten.com/data'
description = <<-TXT
The file density.csv contains the population-weighted density
of each county (or equivalent) in the US and Puerto Rico. The 
densities were constructed from the Census Tract level by 
multiplying tract-level density by population, summing over 
all tracts in a county, and dividing by the county population. 
Below are the fifty counties with the highest weighted density; 
see download for full data.
TXT
weighted_density = <<-TXT
Weighted density - a density metric which measures the density
at which the average citizen lives. It is determined by calculating
the standard density of each census tract, assigning each a weight
equal to its share of the total population, and then adding the segments.
TXT

density = []

CSV.foreach('ca_density.csv') do |row|
  unless row[0] == 'fips'
    h = {}
    h[:id] = County.find_by(name: row[5]).id
    h[:population] = row[1]
    h[:land_area] = row[2]
    h[:density_weighted] = row[3]
    h[:density_average] = row[4]
    h[:name] = row[5]
    density.push(h)
  end
end
density = density.sort { |a, b| a[:id] <=> b[:id] }


 [{:id=>1, :population=>"1510271", :land_area=>"739", :density_weighted=>"10109", :density_average=>"2044", :name=>"Alameda County"}, {:id=>2, :population=>"1175", :land_area=>"738", :density_weighted=>"2", :density_average=>"2", :name=>"Alpine County"}, {:id=>3, :population=>"38091", :land_area=>"595", :density_weighted=>"121", :density_average=>"64", :name=>"Amador County"}, {:id=>4, :population=>"220000", :land_area=>"1636", :density_weighted=>"2145", :density_average=>"134", :name=>"Butte County"}, {:id=>5, :population=>"45578", :land_area=>"1020", :density_weighted=>"68", :density_average=>"45", :name=>"Calaveras County"}, {:id=>6, :population=>"21419", :land_area=>"1151", :density_weighted=>"30", :density_average=>"19", :name=>"Colusa County"}, {:id=>7, :population=>"1049025", :land_area=>"716", :density_weighted=>"4843", :density_average=>"1465", :name=>"Contra Costa County"}, {:id=>8, :population=>"28610", :land_area=>"1006", :density_weighted=>"920", :density_average=>"28", :name=>"Del Norte County"}, {:id=>9, :population=>"181058", :land_area=>"1708", :density_weighted=>"956", :density_average=>"106", :name=>"El Dorado County"}, {:id=>10, :population=>"930450", :land_area=>"5958", :density_weighted=>"4216", :density_average=>"156", :name=>"Fresno County"}, {:id=>11, :population=>"28122", :land_area=>"1314", :density_weighted=>"630", :density_average=>"21", :name=>"Glenn County"}, {:id=>12, :population=>"134623", :land_area=>"3568", :density_weighted=>"1440", :density_average=>"38", :name=>"Humboldt County"}, {:id=>13, :population=>"174528", :land_area=>"4177", :density_weighted=>"3063", :density_average=>"42", :name=>"Imperial County"}, {:id=>14, :population=>"18546", :land_area=>"10181", :density_weighted=>"505", :density_average=>"2", :name=>"Inyo County"}, {:id=>15, :population=>"839631", :land_area=>"8132", :density_weighted=>"3745", :density_average=>"103", :name=>"Kern County"}, {:id=>16, :population=>"152982", :land_area=>"1389", :density_weighted=>"2996", :density_average=>"110", :name=>"Kings County"}, {:id=>17, :population=>"64665", :land_area=>"1256", :density_weighted=>"614", :density_average=>"51", :name=>"Lake County"}, {:id=>18, :population=>"34895", :land_area=>"4541", :density_weighted=>"123", :density_average=>"8", :name=>"Lassen County"}, {:id=>19, :population=>"9818605", :land_area=>"4058", :density_weighted=>"13166", :density_average=>"2420", :name=>"Los Angeles County"}, {:id=>20, :population=>"150865", :land_area=>"2137", :density_weighted=>"2391", :density_average=>"71", :name=>"Madera County"}, {:id=>21, :population=>"252409", :land_area=>"520", :density_weighted=>"6901", :density_average=>"485", :name=>"Marin County"}, {:id=>22, :population=>"18251", :land_area=>"1449", :density_weighted=>"20", :density_average=>"13", :name=>"Mariposa County"}, {:id=>23, :population=>"87841", :land_area=>"3506", :density_weighted=>"840", :density_average=>"25", :name=>"Mendocino County"}, {:id=>24, :population=>"255793", :land_area=>"1935", :density_weighted=>"2455", :density_average=>"132", :name=>"Merced County"}, {:id=>25, :population=>"9686", :land_area=>"3918", :density_weighted=>"120", :density_average=>"2", :name=>"Modoc County"}, {:id=>26, :population=>"14202", :land_area=>"3049", :density_weighted=>"74", :density_average=>"5", :name=>"Mono County"}, {:id=>27, :population=>"415057", :land_area=>"3281", :density_weighted=>"6402", :density_average=>"127", :name=>"Monterey County"}, {:id=>28, :population=>"136484", :land_area=>"748", :density_weighted=>"4046", :density_average=>"182", :name=>"Napa County"}, {:id=>29, :population=>"98764", :land_area=>"958", :density_weighted=>"522", :density_average=>"103", :name=>"Nevada County"}, {:id=>30, :population=>"3010232", :land_area=>"791", :density_weighted=>"8681", :density_average=>"3808", :name=>"Orange County"}, {:id=>31, :population=>"348432", :land_area=>"1407", :density_weighted=>"2547", :density_average=>"248", :name=>"Placer County"}, {:id=>32, :population=>"20007", :land_area=>"2553", :density_weighted=>"33", :density_average=>"8", :name=>"Plumas County"}, {:id=>33, :population=>"2189641", :land_area=>"7207", :density_weighted=>"4005", :density_average=>"304", :name=>"Riverside County"}, {:id=>34, :population=>"1418788", :land_area=>"965", :density_weighted=>"5486", :density_average=>"1471", :name=>"Sacramento County"}, {:id=>35, :population=>"55269", :land_area=>"1389", :density_weighted=>"3289", :density_average=>"40", :name=>"San Benito County"}, {:id=>36, :population=>"2035210", :land_area=>"20057", :density_weighted=>"4616", :density_average=>"101", :name=>"San Bernardino County"}, {:id=>37, :population=>"3095313", :land_area=>"4207", :density_weighted=>"6921", :density_average=>"736", :name=>"San Diego County"}, {:id=>38, :population=>"805235", :land_area=>"47", :density_weighted=>"29908", :density_average=>"17179", :name=>"San Francisco County"}, {:id=>39, :population=>"685306", :land_area=>"1391", :density_weighted=>"4889", :density_average=>"493", :name=>"San Joaquin County"}, {:id=>40, :population=>"269637", :land_area=>"3299", :density_weighted=>"2293", :density_average=>"82", :name=>"San Luis Obispo County"}, {:id=>41, :population=>"718451", :land_area=>"448", :density_weighted=>"9037", :density_average=>"1602", :name=>"San Mateo County"}, {:id=>42, :population=>"423895", :land_area=>"2735", :density_weighted=>"6243", :density_average=>"155", :name=>"Santa Barbara County"}, {:id=>43, :population=>"1781642", :land_area=>"1290", :density_weighted=>"8577", :density_average=>"1381", :name=>"Santa Clara County"}, {:id=>44, :population=>"262382", :land_area=>"445", :density_weighted=>"4554", :density_average=>"589", :name=>"Santa Cruz County"}, {:id=>45, :population=>"177223", :land_area=>"3775", :density_weighted=>"1334", :density_average=>"47", :name=>"Shasta County"}, {:id=>46, :population=>"3240", :land_area=>"953", :density_weighted=>"3", :density_average=>"3", :name=>"Sierra County"}, {:id=>47, :population=>"44900", :land_area=>"6278", :density_weighted=>"177", :density_average=>"7", :name=>"Siskiyou County"}, {:id=>48, :population=>"413344", :land_area=>"822", :density_weighted=>"4502", :density_average=>"503", :name=>"Solano County"}, {:id=>49, :population=>"483878", :land_area=>"1576", :density_weighted=>"3254", :density_average=>"307", :name=>"Sonoma County"}, {:id=>50, :population=>"514453", :land_area=>"1495", :density_weighted=>"4323", :density_average=>"344", :name=>"Stanislaus County"}, {:id=>51, :population=>"94737", :land_area=>"602", :density_weighted=>"2510", :density_average=>"157", :name=>"Sutter County"}, {:id=>52, :population=>"63463", :land_area=>"2950", :density_weighted=>"461", :density_average=>"22", :name=>"Tehama County"}, {:id=>53, :population=>"13786", :land_area=>"3179", :density_weighted=>"6", :density_average=>"4", :name=>"Trinity County"}, {:id=>54, :population=>"442179", :land_area=>"4824", :density_weighted=>"2804", :density_average=>"92", :name=>"Tulare County"}, {:id=>55, :population=>"55365", :land_area=>"2221", :density_weighted=>"1044", :density_average=>"25", :name=>"Tuolumne County"}, {:id=>56, :population=>"823318", :land_area=>"1843", :density_weighted=>"5542", :density_average=>"447", :name=>"Ventura County"}, {:id=>57, :population=>"200849", :land_area=>"1015", :density_weighted=>"4530", :density_average=>"198", :name=>"Yolo County"}, {:id=>58, :population=>"72155", :land_area=>"632", :density_weighted=>"1806", :density_average=>"114", :name=>"Yuba County"}]